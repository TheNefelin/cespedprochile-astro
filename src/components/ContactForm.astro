<form id="contact-form" class="bg-white rounded-3xl shadow-xl p-8 max-w-2xl mx-auto">
  <h2 class="text-3xl font-bold text-gray-800 mb-6">Contáctanos</h2>
  
  <div class="form-control mb-4">
    <label class="label">
      <span class="label-text">Nombre</span>
    </label>
    <input type="text" name="name" placeholder="Tu Nombre" required class="input input-bordered w-full" />
  </div>

  <div class="form-control mb-4">
    <label class="label">
      <span class="label-text">Email</span>
    </label>
    <input type="email" name="email" placeholder="tu@email.com" required class="input input-bordered w-full" />
  </div>

  <div class="form-control mb-4">
    <label class="label">
      <span class="label-text">Teléfono</span>
    </label>
    <input type="tel" name="phone" placeholder="+56 9 12345678" class="input input-bordered w-full" />
  </div>

  <div class="form-control mb-6">
    <label class="label">
      <span class="label-text">Mensaje</span>
    </label>
    <textarea name="message" placeholder="Escribe tu mensaje..." required class="textarea textarea-bordered w-full h-32"></textarea>
  </div>

  <button type="submit" class="btn btn-success btn-block text-white">
    Enviar mensaje
  </button>

  <div id="status-message" class="mt-4"></div>
</form>

<section id="form-loading" class="my-auto mx-auto text-center hidden">
  <span class="loading loading-spinner loading-xl bg-green-600"></span>
</section>

<div id="form-success" role="alert" class="alert alert-success max-w-96 mx-auto text-white hidden">
  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  <span>Tu mensaje ha sido enviado correctamente!!!</span>
</div>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const loading = document.getElementById('form-loading') as HTMLElement;;
  const success = document.getElementById('form-success') as HTMLElement;;
  const statusDiv = document.getElementById('status-message') as HTMLElement;;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
  // Limpiar errores previos
  statusDiv.innerHTML = '';
  form.querySelectorAll('input, textarea').forEach(el => {
    el.classList.remove('border-red-500', 'ring-1', 'ring-red-500');
  });

  // Mostrar loading
  form.classList.add('hidden');
  loading.classList.remove('hidden');

  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  try{
    const response = await fetch('/api/send-email', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    loading.classList.add('hidden');

    if (!response.ok) {
      // Marcar campo con error si existe
      if (result.field) {
        const input = form.querySelector(`[name="${result.field}"]`);
        input?.classList.add('border-red-500', 'ring-1', 'ring-red-500');
      }

      // Mostrar mensaje de error
      statusDiv.innerHTML = `<div class="alert alert-error">${result.error}</div>`;
      form.classList.remove('hidden'); // Volver a mostrar el formulario
    } else {
      // Mostrar éxito
      success.classList.remove('hidden');
      // No volvemos a mostrar el formulario
    }    
  } catch (err) {
    loading.classList.add('hidden');
    statusDiv.innerHTML = `<div class="alert alert-error">Error al enviar. Intenta nuevamente.</div>`;
    form.classList.remove('hidden'); // Volver a mostrar el formulario
  }
});
</script>